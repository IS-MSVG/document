# 面向微服务负载均衡的智能网关设计与实现
## 多维度指标综合的动态负载计算
### 服务节点负载计算
#### CPU 负载计算
#### 内存负载计算
#### 磁盘负载计算
### 服务实例负载计算
#### CPU 负载计算
#### 内存负载计算
#### API 请求次数
#### API 响应时间
##### 记录方法
- 通过 `envoy filter` 对 `request` 捕获时间与 `response` 捕获时间做插值处理得到 `API` 的响应时间，响应时间需要有一个正常的波动区间，在一定范围内的响应时间都是正常的。
- 响应时间过长时被认定为出现问题这时需要考虑`API`响应状态来确定是响应出错还是单纯的响应时间增长
#### API 响应状态比例
- 一般`API`响应状态为20x和30x都为正确响应，40x和50x都为错误响应，当40x的相应出现时需要拉响警报，给出一个高负载值。
### 多方面服务实例负载考虑
## 细粒度版本兼容性的路由策略
### 请求解析
### 服务兼容区间获取与兼容区间更新
### 负载均衡转发
## 两阶段的服务请求路由机制
### API网关 服务兼容性的解析
### 服务网格 服务调用链分析